# コード構造解析 (index.html 5352行)

## ファイル構造マッピング

### HTML構造 (1-1566行、1566-5352行)
```
<!DOCTYPE html>
<html>
  <head> (3-1565行)
    - meta tags & CSP設定 (4-6行)
    - title (7行)
    - Supabase SDK読み込み (9-19行)
    - CSS定義 (21-1564行) [1543行]
  </head>

  <body> (1566-5351行)
    - HTMLコンテンツ構造 (1566-1726行) [160行]
    - 初期化スクリプト (1727-1741行) [14行]
    - メインアプリケーションスクリプト (1744-5350行) [3606行]
  </body>
</html>
```

### セクション別詳細分析

#### 1. CSS セクション (21-1564行、1543行)
- **Supabase認証UI** (39-50行)
- **ダッシュボード** (51-150行)
- **認証画面** (151-206行)
- **Discord認証** (207-265行)
- **メインコンテンツ** (266-342行)
- **装備方針** (343-360行)
- **タブシステム** (361-392行)
- **層選択** (393-423行)
- **優先度設定** (424-473行)
- **武器希望** (474-637行)
- **統計情報** (638-701行)
- **編集モード** (702-757行)
- **フォーム** (758-812行)
- **優先順位設定** (813-911行)
- **ロール別色分け** (912-991行)
- **エラーメッセージ** (992-1010行)
- **データ移行** (1011-1564行)

#### 2. HTML コンテンツ (1566-1726行、160行)
- コンテナ構造
- 認証画面HTML
- ダッシュボードHTML
- モーダル・フォーム構造

#### 3. 初期化スクリプト (1727-1741行、14行)
```javascript
// Supabase読み込み確認
// DOMContentLoaded初期化
```

#### 4. メインスクリプト (1744-5350行、3606行)
- **設定・定数** (1744-1796行)
- **ユーティリティ関数** (1753-1796行)
- **アプリ初期化** (1798-1909行)
- **認証システム** (1910-2653行)
- **UI管理** (2467-2713行)
- **メイン機能** (2714-5349行)

## 詳細コンポーネント分析

### A. 設定・定数セクション (1744-1796行)
```javascript
// Discord OAuth2設定
const DISCORD_CONFIG = {...}

// Supabase設定
window.SUPABASE_CONFIG = {...}

// グローバル変数
let isAuthenticated = false;
let currentTeamId = null;
// ... 他のグローバル変数
```

### B. ユーティリティ関数 (1753-1796行)
```javascript
function getPositionRoleClass(position) {...}
function getDisplayTeamName(teamName) {...}
```

### C. 認証システム (1910-2653行、743行)
#### サブコンポーネント:
- **Discord認証** (2017-2176行)
- **チーム認証** (2177-2350行)
- **チーム作成** (2351-2465行)
- **パスワードリセット** (2467-2653行)

### D. UI管理 (2467-2713行、246行)
```javascript
function showError(message) {...}
function showSuccess(message) {...}
function showMessage(message, type) {...}
```

### E. メイン機能群 (2714-5349行、2635行)
#### 主要サブシステム:
- **ダッシュボード** (2795-3030行、235行)
- **プレイヤー管理** (3248-3888行、640行)
- **装備分配** (3926-4705行、779行)
- **統計分析** (4789-5112行、323行)
- **履歴管理** (5178-5315行、137行)
- **システム設定** (5317-5349行、32行)

## 依存関係の特徴

### グローバル変数依存
```javascript
// 共有状態変数（複数関数で参照・更新）
isAuthenticated, currentTeamId, currentTierId
supabaseClient, allData, currentData
isInitializing, isInitialized
```

### DOM要素依存
- HTML要素IDによる直接操作
- クラス名による要素選択
- イベントハンドラーの動的バインド

### 機能間相互呼び出し
- 認証 → ダッシュボード
- ダッシュボード → 各機能
- データ管理 → 表示更新
- エラーハンドリング → UI更新

## 分離における課題

### 高結合要素
1. **グローバル状態**: 全機能が共有変数に依存
2. **DOM操作**: HTML構造と密結合
3. **イベント処理**: 複数機能間でのイベント伝播
4. **データフロー**: Supabaseとの同期処理

### 低結合要素
1. **CSS定義**: 独立したスタイル定義
2. **定数設定**: 設定値の分離
3. **ユーティリティ**: 純粋関数
4. **表示ロジック**: 一部の表示生成関数

この解析により、安全な分離戦略の基盤が確立されました。