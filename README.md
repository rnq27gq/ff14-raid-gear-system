# FF14 零式装備分配システム 

<div>

**FF14の零式レイドで装備を公平に分配するためのWebアプリケーション**

</div>

---

## 目次
- [Discord Bot導入](#discord-bot導入)
- [クイックスタート](#クイックスタート)
- [分配システムの仕組み](#分配システムの仕組み)
  - [基本ロジック](#基本ロジック)
  - [装備ステータス一覧](#装備ステータス一覧)
  - [ジョブ優先度](#ジョブ優先度)
  - [断章交換システム](#断章交換システム)
- [詳しい使い方](#詳しい使い方)
- [よくある質問](#よくある質問)
- [技術スタック](#技術スタック)
---

## Discord Bot導入

### Botをサーバーに追加

以下のリンクをクリックして、あなたのDiscordサーバーにBotを招待してください。

<a href="https://discord.com/oauth2/authorize?client_id=1421136327843250286&permissions=2147485696&integration_type=0&scope=bot+applications.commands" target="_blank">Botを招待する</a>

必要な権限:
- メッセージを送信
- スラッシュコマンドを使用

---

## クイックスタート

### 1. Discordで専用URLを作成

DiscordサーバーでDiscord Botの `/share` コマンドを実行します。

![Discord /share コマンド](SS/share5.png)
<p align="center"><i>Discord /share コマンド画面</i></p>

専用URLが生成されます。このURLをクリックしてアクセスしてください。



### 2. 専用URLにアクセス

共有されたURLをクリックすると、ダッシュボードが表示されます。

![トップページ](SS/toppage1.png)
<p align="center"><i>トップページ（ダッシュボード）</i></p>

---

### 3. メンバー情報を設定

メンバー設定ブロックで8人分の情報を入力します。

#### 入力項目
- **名前** - プレイヤー名
- **ジョブ** - 各メンバーのジョブ
- **装備方針** - 最適装備が零式の部位をクリック（空白=トームストーン）
- **武器希望** - 第2・第3希望の武器を設定

#### 保存
すべて入力したら「一括保存」をクリック。
途中経過も保存できます（1名以上の名前とジョブ入力必須）。


---

## 詳しい使い方

### 装備分配の実行

#### 手順

1. **層を選択**
   レイドをクリアしたらダッシュボード上で対応する層（1層/2層/3層/4層）をクリック

2. **分配を確定**
   ドロップしたアイテムとシステムが提案した分配先を確認して「分配を確定」ボタンをクリック

   ![分配計算画面](SS/calc3.png)
   <p align="center"><i>分配計算画面</i></p>

3. **統計情報を確認**
   システムが分配結果を自動記録します

   ![分配結果画面](SS/result4.png)
   <p align="center"><i>統計情報画面</i></p>
---

### 配布履歴の確認

「配布履歴」ボタンをクリックすると、過去の分配記録を確認できます。

![配布履歴](SS/history6.png)
<p align="center"><i>配布履歴画面</i></p>

#### フィルター機能
- **週** - 週ごとにフィルター
- **層** - 1層〜4層でフィルター
- **装備部位** - 特定部位でフィルター
- **取得者** - 特定プレイヤーでフィルター

#### 削除機能
各データの右端にある「削除」ボタンで誤った記録を削除できます。

---

## 分配システムの仕組み

### 基本ロジック

このシステムは装備を3つの要素で自動計算して公平に分配します：

1. **装備方針（零式 or トームストーン）**
   - メンバー設定で部位ごとに設定
   - 零式設定のプレイヤーが優先される

2. **ジョブ優先度（ポジション順）**
   - デフォルト: D1 → D2 → D3 → D4 → MT → ST → H1 → H2
   - 優先順設定画面でカスタマイズ可能

3. **取得履歴（動的優先度）**
   - 装備を多く取得しているプレイヤーは優先度が下がる
   - 全員に公平に行き渡るよう自動調整

**具体例：**

耳装備が2個ドロップした場合
- 零式設定のプレイヤーを抽出
- その中でD1 → D2 → D3... の順に優先
- 同じ優先度なら取得数が少ない方を優先

---

### 装備ステータス一覧

各装備には以下のステータスがあります：

#### 零式設定のプレイヤー向けステータス

**通常装備（耳/首/腕/指/頭/手/足/胴/脚）:**

| ステータス | 説明 | 分配対象 |
|-----------|------|---------|
| 未取得 | まだ取得していない | 最優先 |
| 取得済 | ドロップ箱から取得済み | 対象外 |
| 断章交換 | 断章で交換済み（箱未取得） | 条件付き復活 |
| 断章交換・箱取得済 | 断章交換後に箱も取得 | 完全除外 |

**武器:**

| ステータス | 説明 | 分配対象 |
|-----------|------|---------|
| 未取得 | まだ取得していない | 最優先 |
| 取得済 | 武器箱から取得済み | 対象外 |
| 直ドロ入手 | 直ドロ武器で取得済み（箱未取得） | 条件付き復活 |
| 直ドロ入手・箱取得済 | 直ドロと箱の両方取得 | 完全除外 |
| 断章交換 | 断章で交換済み（箱未取得） | 条件付き復活 |
| 断章交換・箱取得済 | 断章交換後に箱も取得 | 完全除外 |

#### トームストーン設定のプレイヤー向け

- 零式設定のプレイヤーが全員取得した後に分配対象になります
- ステータスは「未取得」と「取得済」のみ

---

### ジョブ優先度

同じ装備方針・取得履歴の場合、ジョブ（ポジション）で優先順位が決まります。

**デフォルト優先順位:**

D1 → D2 → D3 → D4 → MT → ST → H1 → H2

**カスタマイズ方法:**
1. ダッシュボードの「優先順設定」をクリック
2. ポジションをドラッグ&ドロップで並び替え
3. 「保存」をクリック

**具体例：**

D1とD2が両方とも零式設定で耳装備が未取得の場合
- デフォルトではD1が優先される
- 取得数が同じならD1が取得、D2は次回優先される

---

### 断章交換システム

断章で装備を交換した場合の特別な仕組みです。

#### 基本コンセプト

- 断章交換者は「ゲーム内で既に装備を入手済み」
- しかし「固定メンバーとしてドロップ箱をまだ受け取っていない」
- この状態を公平に扱うための仕組み

#### 復活メカニズム（重要）

**ステップ1: 一時除外**
- 断章交換した時点で「断章交換」ステータスになる
- 零式設定で「未取得」のプレイヤーがいる間は分配対象外

**ステップ2: 条件付き復活**
- 零式設定のプレイヤー全員が装備を取得したら自動的に復活
- ドロップ箱の分配対象として再び候補に上がる
- 理由: 全員に行き渡ったので、断章交換者も箱を受け取る権利がある

**ステップ3: 完全除外**
- 復活後にドロップ箱を取得すると「断章交換・箱取得済」に自動更新
- 以降は完全に分配対象外（ゲーム内装備もドロップ箱も両方取得済みのため）

#### 武器の場合の注意点

武器には「直ドロップ武器」もあるため、復活条件がより複雑です：
- 断章交換者が復活するには「全員が何らかの武器を取得している」必要がある
- 直ドロ武器を取得したプレイヤーも同じ復活メカニズムが適用される

#### 使い方

1. 統計情報画面で「編集開始」をクリック
2. 該当プレイヤーの装備部位で「断章交換」を選択
3. 保存すると自動的に復活メカニズムが適用される

#### 視覚的な確認

統計情報画面で各装備のステータスが色分け表示されます：
- 黄色: 断章交換（一時除外中）
- 青色: 断章交換・箱取得済（完全除外）

#### 具体例

8人パーティで耳装備の場合：

**週1:** D1が断章で耳装備を交換 → 「断章交換」ステータス
　　　　ドロップ分配: D2, D3, D4... の順に未取得者へ

**週5:** 零式設定の全員（D2～H2）が耳装備を取得
　　　　→ D1が自動的に復活、次の分配候補になる

**週6:** D1がドロップ箱から耳装備を取得
　　　　→ 「断章交換・箱取得済」に自動更新、以降は対象外

**結果:** D1はゲーム内で使う装備（断章交換）と、ドロップ箱（週6）の両方を取得

#### 直ドロップ武器分配

4層でドロップする武器は希望順位で優先度が決まります：
- 攻略中のジョブ（第1希望） > 第2希望 > 第3希望の順に優先
- 希望がない場合は分配対象外

**8週クリア時の理想状態:**
- 全員が「緑色（取得済）」または「青色（断章交換・箱取得済）」

---

## よくある質問


### Q: メンバーを途中で変更できる？

A: 可能です。メンバー設定ブロックから編集して「一括保存」をクリックしてください。


### Q: 間違って分配を確定してしまった場合は？

A: 配布履歴画面の「削除」ボタンで該当記録を削除できます。または統計情報の「編集開始」から手動修正も可能です。

### Q: 複数のレイドティアを管理できる？

A: 1つのリンクにつき1つのレイドが対応しています。
新しいパッチの零式が始まる場合は、/shareコマンドで新しいリンクを作成してください。

### Q: 断章交換したらずっと分配されないの？

A: いいえ。零式設定の全員が取得したら自動的に復活します。その後ドロップ箱を受け取れば、断章交換分と箱の両方を入手したことになります。

### Q: 直ドロップ武器を取得したら武器箱はもらえない？

A: 他に未取得者がいる間は後回しになりますが、全員が武器を取得したら武器箱の分配候補として復活します。

---

## 技術スタック

### フロントエンド
- **HTML5 / CSS3** - レスポンシブデザイン
- **Vanilla JavaScript** - 依存関係なし、軽量で高速

### バックエンド / インフラ
- **Supabase** - PostgreSQLデータベース、リアルタイム同期
- **GitHub Pages** - 静的サイトホスティング（無料）
- **Fly.io** - Discord Botホスティング（無料枠で運用）

### Discord Bot
- **Node.js 18** - サーバーサイドJavaScript
- **discord.js v14** - Discord API ラッパー
- **Docker** - コンテナ化

### 開発ツール
- **Git / GitHub** - バージョン管理
- **PM2** - プロセス管理（ローカル開発用）

### 完全無料で運用可能
すべてのサービスの無料枠内で動作するよう設計されています。

---

## 開発者

**ひろとも** | 2025年

ファイナルファンタジーXIVコミュニティのために設計


