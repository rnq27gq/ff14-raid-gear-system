# FF14 零式装備分配システム

FF14の零式レイドチーム向けの装備分配管理システムです。8人固定チームでの公平で透明性のある装備分配を支援します。

## 概要

このシステムは8人レイドチームの装備分配を、公平な優先度アルゴリズムを使用して管理します。リアルタイムでの共同作業をサポートし、プレイヤーの希望を追跡し、長期的に公平な装備分配を実現するための履歴データを保持します。

## 主な機能

### 装備分配
- **Need/Greed/Passシステム**: 標準的なMMOの装備分配方式
- **スマート優先度計算**: ポジション優先度、装備方針、取得履歴を考慮
- **武器分配**: 武器箱と直ドロップ武器の専用処理
- **断章交換サポート**: 断章で交換した装備の高度な追跡機能

### チーム管理
- **8ポジション対応**: MT/ST/H1/H2/D1/D2/D3/D4のジョブ割り当て
- **装備方針管理**: プレイヤー個別の零式/トームストーン装備希望
- **武器希望システム**: 武器種別の優先順位設定

### セキュリティとアクセス
- **チーム認証**: パスワード保護によるセキュアなチーム作成
- **パスワード復旧**: セキュリティ質問による安全なパスワードリセット
- **リアルタイム同期**: チームメンバー全員へのライブ更新

### 統計と履歴
- **取得統計**: 装備分配の包括的な追跡
- **分配履歴**: 過去の全分配記録
- **手動調整**: データ修正のための管理者機能

## クイックスタート

### デモアクセス
ライブアプリケーション: [https://rnq27gq.github.io/ff14-raid-gear-system/](https://rnq27gq.github.io/ff14-raid-gear-system/)

**デモアカウント:**
- チームID: `demo-team`
- パスワード: `demo123`

### チーム作成

1. **アプリケーションにアクセス**
   - アプリケーションURLにアクセス
   - 「新しいチームを作成」をクリック

2. **チーム設定**
   - 一意のチームIDを選択（3-20文字、英数字）
   - セキュアなパスワードを設定（6文字以上）
   - パスワード復旧用の作成者名を入力
   - セキュリティ質問と答えを設定

3. **メンバー設定**
   - 8人全員のメンバーと希望ジョブを追加
   - 装備方針を設定（各部位の零式/トームストーン希望）
   - 武器希望を設定（第1〜第4希望）

4. **分配開始**
   - 分配システムにアクセス
   - 層メニューからドロップアイテムを選択
   - システム推奨を確認
   - 分配を確定

## 分配システムの仕組み

### 優先度計算

システムは複数の要素を使用して分配優先度を計算します：

1. **装備方針**: 零式装備を優先するプレイヤーは、トームストーン装備希望者より高い優先度
2. **ポジション優先度**: カスタマイズ可能な順序（デフォルト: D1 → D2 → D3 → D4 → MT → ST → H1 → H2）
3. **取得履歴**: 過去の装備取得に基づく動的調整
4. **武器希望**: 武器種別のランキングシステム

### スコアリングシステム

- **零式Need**: 1000 + ポジション優先度 - 動的ペナルティ
- **トームGreed**: 500 + ポジション優先度 - 動的ペナルティ
- **武器箱**: 2000 + ポジション優先度 - 動的ペナルティ
- **直ドロップ武器**: 3000 + ポジション優先度 - 希望順位 × 100 - 動的ペナルティ

### 断章交換システム

断章で装備を交換したプレイヤー向けの高度な機能：
- **一時的除外**: 零式方針のプレイヤーが装備を必要としている間は除外
- **条件付き復帰**: 零式方針のプレイヤーが誰もアイテムを必要としなくなったら再び対象に
- **自動ステータス更新**: 箱取得時にシステムが自動的にステータスを更新

## 技術要件

### 対応ブラウザ
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### データベース設定

このアプリケーションはSupabaseをバックエンドとして使用します。新規デプロイの場合：

1. **Supabaseプロジェクト作成**
   - [supabase.com](https://supabase.com)でサインアップ
   - 新しいプロジェクトを作成
   - プロジェクトURLとanon keyをメモ

2. **データベース設定**
   ```sql
   -- 必要な拡張機能を有効化
   CREATE EXTENSION IF NOT EXISTS "pgcrypto";
   
   -- teamsテーブル作成
   CREATE TABLE teams (
       id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
       team_id VARCHAR(50) UNIQUE NOT NULL,
       team_name VARCHAR(100) NOT NULL,
       password_hash VARCHAR(255),
       security_question TEXT,
       security_answer_hash VARCHAR(255),
       reset_token VARCHAR(100),
       reset_token_expires TIMESTAMP WITH TIME ZONE,
       created_by VARCHAR(100),
       created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
       last_access TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );
   
   -- raid_dataテーブル作成
   CREATE TABLE raid_data (
       id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
       team_id VARCHAR(50) NOT NULL,
       tier_id VARCHAR(50) NOT NULL,
       data_type VARCHAR(20) NOT NULL CHECK (data_type IN ('players', 'allocations', 'settings', 'equipmentData')),
       content JSONB NOT NULL,
       created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
       updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );
   ```

3. **行レベルセキュリティ有効化**
   ```sql
   ALTER TABLE teams ENABLE ROW LEVEL SECURITY;
   ALTER TABLE raid_data ENABLE ROW LEVEL SECURITY;
   
   CREATE POLICY "Teams can only access their own data" ON raid_data
       FOR ALL USING (team_id = current_setting('app.current_team_id', true));
   ```

## 利用ガイド

### チームリーダー向け

1. **初期設定**
   - セキュアな認証情報でチームアカウントを作成
   - 正確なジョブ情報で8人全員を追加
   - デフォルトと異なる場合はポジション優先度を設定
   - 各メンバーの装備方針を設定

2. **週次運用**
   - レイド前に分配システムにアクセス
   - ドロップアイテムが出現したら入力
   - システム推奨を確認して承認
   - 必要に応じて手動調整を実施

3. **メンテナンス**
   - 公平性のため定期的に統計を確認
   - 必要に応じてメンバー情報を更新
   - バックアップ用にデータをエクスポート

### チームメンバー向け

1. **初期設定**
   - チームリーダーにジョブとキャラクター情報を提供
   - 装備希望を指定（各部位の零式/トームストーン）
   - 武器希望ランキングを設定

2. **継続利用**
   - 現在の分配統計を確認
   - 分配履歴をチェック
   - レイド中はリアルタイム更新のためシステムにアクセス

### 管理者向け

1. **データ管理**
   - システムパフォーマンスと使用状況の監視
   - 定期的なデータベースメンテナンス
   - 必要に応じてパスワードリセット対応

2. **トラブルシューティング**
   - ブラウザコンソールでJavaScriptエラーをチェック
   - Supabase接続状況の確認
   - 必要に応じてデータ修正の支援

## 高度な機能

### ポジション優先度カスタマイズ

チームはデフォルトのポジション優先度順序を調整できます：
1. ダッシュボードから「優先度設定」にアクセス
2. ドラッグ&ドロップでポジションを並び替え
3. 変更を保存 - 今後の全分配に影響

### 統計の手動編集

修正や調整のため：
1. 「統計情報」セクションに移動
2. 「編集モード」をクリック
3. 任意のアイテムの取得状況を切り替え
4. 変更を保存してシステム状態を更新

### データエクスポート/インポート

- **エクスポート**: チームデータをJSONで完全ダウンロード
- **インポート**: 以前のシステムやバックアップからデータをアップロード
- **CSV対応**: 基本メンバー情報をCSV経由でインポート

## セキュリティ考慮事項

### パスワード管理
- チームアカウントには強力で一意のパスワードを使用
- 覚えやすいが推測しにくいセキュリティ質問を選択
- チームメンバーに変更があった場合は定期的にパスワード更新

### データプライバシー
- チームデータは行レベルセキュリティで分離
- クロスチームデータアクセスは不可能
- 重要な進行データには定期バックアップを推奨

### アクセス制御
- チームIDは信頼できるメンバーのみと共有
- メンバーが離脱した場合は認証情報のローテーションを検討
- 異常なアクセスがないかアクセスログを監視

## トラブルシューティング

### よくある問題

**ログイン問題**
- チームIDとパスワードのスペルを確認
- 認証情報を忘れた場合はパスワードリセットを使用
- 接続エラーがないかブラウザコンソールをチェック

**データ同期問題**
- ページを更新して強制再同期
- インターネット接続の安定性を確認
- 問題が続く場合はブラウザキャッシュをクリア

**パフォーマンス問題**
- 最新のブラウザバージョンを確認
- 不要なブラウザタブを閉じる
- コンソールでJavaScriptエラーをチェック

### ヘルプの取得

技術的な問題や機能要求については：
1. 上記のトラブルシューティングセクションを確認
2. ブラウザが最小要件を満たしているかを確認
3. 具体的なエラーメッセージと共にシステム管理者に連絡

## 開発情報

### アーキテクチャ
- **フロントエンド**: 純粋なHTML/CSS/JavaScript（フレームワークなし）
- **バックエンド**: Supabase（PostgreSQL + 認証 + リアルタイム）
- **ホスティング**: GitHub Pages（静的ホスティング）
- **セキュリティ**: 行レベルセキュリティ + bcryptパスワードハッシュ化

### 貢献
このプロジェクトはファイナルファンタジーXIVのレイドチーム向けに設計されています。主に内部利用を目的としていますが、フィードバックや提案は歓迎します。

## ライセンス

このプロジェクトは、ファイナルファンタジーXIVコミュニティ内での個人およびチーム利用を目的としています。商用配布は対象外です。

---

**ファイナルファンタジーXIVレイドコミュニティのために設計**