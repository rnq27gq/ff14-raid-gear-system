# FF14零式装備分配システム - 動的優先度調整システム詳細

## 📋 システム概要

FF14零式装備分配システムでは、**現在装備状況**と**装備方針設定**に基づいたNeed/Greed/Pass判定に加えて、装備取得履歴による**動的優先度調整**を組み合わせた公平な分配システムを採用しています。

## 🎯 システムの目的

1. **公平性の確保**: 全員に装備を行き渡らせることを最終目標とする
2. **現実的な判定**: 
   - 各メンバーの**現在装備状況**（すでに対象の装備を取得してるか）
   - **装備方針**で零式が選択されている部位として該当するか
   - 上記に基づくNeed/Greed/Pass判定
3. **累積的調整**: 装備取得履歴による動的優先度調整で長期的な公平性を実現
4. **透明性**: 優先度計算ロジックを明確化し、予測可能な分配を実現

## 🎮 基本判定システム（working_index.html準拠）

### Need/Greed/Pass判定の基準

#### Need判定（総合優先度 ≥ 100点）
- **装備方針**: 対象スロットが「零式」に設定されている
- **現在装備**: 該当スロットが未取得 OR 新装備のitemLevelが現在装備より高い
- **基礎点数**: 100点（装備方針による）
- **追加点数**: ポジション優先度（10-30点）

#### Greed判定（50点 ≤ 総合優先度 < 100点）
- **装備方針**: 対象スロットが「トームストーン」に設定されている
- **現在装備**: 該当スロットが未取得 OR 新装備のitemLevelが現在装備より高い
- **基礎点数**: 50点（装備方針による）
- **追加点数**: ポジション優先度（10-30点）

#### Pass判定（総合優先度 < 50点）
- **装備方針**: 対象スロットが未設定 OR 
- **現在装備**: 既により良い装備を所持している
- **その他**: アップグレード不要と判定

### 装備状況の管理

#### 現在装備状況の設定
各プレイヤー、各装備スロット（10箇所）ごとに以下の状態を設定：

| 状態 | 説明 | itemLevel | 判定への影響 |
|-----|------|-----------|-------------|
| **未取得** | まだ装備を取得していない | なし | Need/Greed判定対象 |
| **零式** | 零式装備を取得済み | 730 | より高いitemLevelのみ対象 |
| **トームストーン** | トームストーン装備を取得済み | 720 | より高いitemLevelのみ対象 |

#### 装備方針の設定
各プレイヤー、各装備スロットごとに分配方針を設定：

| 方針 | 説明 | 基礎優先度 | 判定結果 |
|-----|------|-----------|----------|
| **零式** | 零式装備を優先取得 | 100点 | Need判定可能 |
| **トームストーン** | トームストーン装備で十分 | 50点 | Greed判定 |
| **未設定** | デフォルト（零式扱い） | 100点 | Need判定可能 |

## 🔧 実際の判定基準

### 判定に影響する要素（のみ）

1. **対象装備の取得状況**: その装備スロットをすでに取得しているか
2. **装備方針設定**: その装備スロットが「零式」or「トームストーン」に設定されているか  
3. **ポジション優先度**: 設定されたポジション優先度での順位

### 判定に影響しない要素

- **他の装備の取得状況**: 武器を取得していても胴装備の優先度には影響しない
- **ItemLevel**: レイドごとに変動するため考慮しない
- **取得履歴の累積**: 各装備スロットは独立して判定される

### ポジション優先度システム

各装備について、**分配優先度設定**に基づいてポジション優先度が決定されます：

#### 分配優先度設定との連動
- **分配優先度設定画面**での並び順が、そのままポジション優先度になります
- ドラッグ&ドロップで並び替えることで、全装備の優先度を一括変更可能
- 上位にあるポジションほど高い優先度（数値が小さい）を持ちます

#### デフォルト分配優先度
設定されていない場合の初期順序：
1. **D1** （優先度: 0）
2. **D2** （優先度: 1）
3. **D3** （優先度: 2）
4. **D4** （優先度: 3）
5. **H1** （優先度: 4）
6. **H2** （優先度: 5）
7. **MT** （優先度: 6）
8. **ST** （優先度: 7）

*この順序は管理者が自由に変更可能で、変更は全装備に適用されます*

## 📊 実際の分配決定プロセス

### 分配判定フロー

1. **対象装備の確認**: 分配対象となる装備スロットを特定
2. **個別判定**: 各プレイヤーについて以下を確認
   - その装備スロットをすでに取得済みか？
   - その装備スロットの装備方針は何か？
3. **Need/Greed/Pass分類**: 判定基準に基づいてグループ分け
   - **Need**: 零式方針 + 未取得
   - **Greed**: トームストーン方針 + 未取得
   - **Pass**: 取得済み or 方針なし
4. **分配優先度適用**: 各グループ内で分配優先度設定順にソート
5. **勝者決定**: 最も優先度の高いプレイヤーが取得

### 具体例：胴装備の分配

#### プレイヤー設定
- **D1（竜騎士）**: 胴装備「零式」方針、現在「未取得」
- **D2（忍者）**: 胴装備「零式」方針、現在「取得済み」
- **D3（黒魔道士）**: 胴装備「トームストーン」方針、現在「未取得」
- **MT（ナイト）**: 胴装備「零式」方針、現在「未取得」

#### 分配優先度設定
現在の設定順序： D1 → D2 → D3 → D4 → H1 → H2 → MT → ST

#### 判定結果
1. **Need判定**: D1（未取得+零式方針）、MT（未取得+零式方針）
2. **Greed判定**: D3（未取得+トームストーン方針）
3. **Pass判定**: D2（取得済み）
4. **分配優先度適用**: D1（優先度0）> MT（優先度6）> D3（優先度2）
5. **最終勝者**: D1（Needグループで最高優先度）

### 重要なポイント

- D2は他に何も取得していなくても、**胴装備が取得済み**のためPass
- D1とMTはどちらもNeed判定だが、**分配優先度設定**でD1が勝利
- D3は零式方針ではないため、Need者がいる限りGreed判定
- **分配優先度設定を変更**すれば、MT→D1の順序で優先度を変更可能

## ⚠️ 重要な仕様

### 装備スロット独立性
- **各装備スロットは完全に独立**: 武器を取得していても胴装備の判定には影響しない
- **スロット別管理**: 装備方針も取得状況も装備スロットごとに個別設定

### 判定の優先順位
1. **Need判定者がいる場合**: Greed判定者は取得できない
2. **同一判定内**: ポジション優先度の高い順で決定
3. **全員Pass**: 装備は分解・保管扱い

### フリロ（フリーロット）
- 予測システムとは別に、実際の取得者を手動で設定可能
- 管理者の裁量で最終調整が可能

### データ管理
- **装備状況**: プレイヤー設定で各スロットの取得状況を管理
- **装備方針**: プレイヤー設定で各スロットの方針を設定
- **ポジション優先度**: 管理者が全体設定で調整可能

---

このシステムにより、FF14零式レイドでの装備分配が**対象装備の取得状況**と**ポジション優先度**に基づく明確で公平な分配となります。

