# FF14零式装備分配管理システム

## 1. プロジェクト概要

### 1.1 プロジェクト名
FF14零式装備分配管理システム（FF14 Savage Gear Distribution Manager）

### 1.2 目的・背景
FF14の零式レイドにおいて、8人固定パーティ（MT/ST/H1/H2/D1/D2/D3/D4）が獲得した零式装備を、既定の優先順位（DPS Melee > DPS その他 > Tank > Healer）に基づいて公平かつ効率的に分配するためのシステム。現在はスプレッドシートで管理しているが、より直感的で使いやすいWebアプリケーションとして構築し、分配の透明性と効率性を向上させる。

### 1.3 対象ユーザー
- 8人の固定パーティメンバー（各ジョブ・ポジション担当）
- 固定リーダー（分配最終決定権を持つユーザー）

### 1.4 プロジェクトの成功指標
- 装備分配にかかる時間の短縮（現在の50%以下）
- メンバー間の分配に関する不満・トラブルの減少
- 全メンバーが簡単にアクセス・操作できること
- 分配履歴の透明性確保と装備更新状況の可視化

## 2. 機能要件

### 2.1 主要機能
#### 機能1: メンバー・ジョブ管理
- **概要**: 8人のメンバー情報とジョブ情報を管理
- **詳細**: 
  - メンバー名、キャラクター名、担当ポジション（MT/ST/H1/H2/D1/D2/D3/D4）の登録
  - 各ポジションの担当ジョブ設定（Tank: ナイト/戦士/暗黒騎士/ガンブレ、Healer Pure: 白魔道士/占星術士、Healer Barrier: 学者/賢者、DPS Melee: モンク/竜騎士/忍者/侍/リーパー/ヴァイパー、DPS Range: 吟遊詩人/機工士/踊り子、DPS Caster: 黒魔道士/召喚士/赤魔道士/ピクトマンサー）
  - 現在装備しているアイテムレベル・装備状況の管理
- **優先度**: 高

#### 機能2: 零式装備登録・ドロップ管理
- **概要**: 各層での装備ドロップを管理
- **詳細**: 
  - **1層**: 耳箱、首箱、腕箱、指箱（各1個固定）
  - **2層**: 頭箱、手箱、足箱、武器石、硬化薬（各1個固定）
  - **3層**: 胴箱、脚箱、強化薬、強化繊維（各1個固定）
  - **4層**: 胴箱、武器箱、マウント、直ドロップ武器（各1個固定）
  - 各層クリア時の装備ドロップ確認機能
  - ドロップ日時の自動記録（火曜リセット基準）
  - 実装週の複数回クリア対応
- **優先度**: 高

#### 機能3: リアルタイムNeed/Greed/Pass判定システム
- **概要**: レイドクリア時に各メンバーの選択肢を即座に表示
- **詳細**: 
  - 装備ドロップ時の瞬時判定表示
  - 各メンバーの現在装備状況に基づく自動判定
  - 装備選択方針（零式/トームストーン）に基づく推奨表示
  - 優先順位に基づくNeed権利者の明確化
  - Need/Greed/Pass の色分け表示（Need: 赤、Greed: 黄、Pass: グレー）
  - 複数人がNeedの場合の優先順位表示
- **優先度**: 高

#### 機能4: メンバー装備方針管理
- **概要**: 各メンバーの部位別装備選択方針を管理
- **詳細**: 
  - ジョブ別装備スロット管理（武器、頭、胴、手、脚、足、耳、首、腕、指）
  - 各部位ごとの装備選択（零式装備 or トームストーン装備）
  - 装備方針の変更履歴管理
  - 現在装備の記録・更新機能
  - 装備完成度の可視化
- **優先度**: 高

#### 機能6: 4層直ドロップ武器管理システム
- **概要**: 4層でランダムドロップする武器の事前希望管理と配布優先順位決定
- **詳細**: 
  - **直ドロップ武器の特徴**
    - 全ジョブ武器からランダムで1つドロップ
    - 武器箱は取得者が任意のジョブ武器を選択可能
    - 直ドロップ武器は該当ジョブのみ使用可能
  - **事前希望登録システム**
    - 各メンバーが希望するジョブ武器を複数登録
    - 希望理由・優先度の記録
    - 希望変更履歴の管理
  - **自動配布優先順位システム**
    1. **最優先**: 登録ジョブに該当 かつ 武器未取得のメンバー
    2. **第2優先**: 登録ジョブ以外 かつ 希望登録済みのメンバー
    3. **最終**: 該当者なしの場合は分解・保管
  - **判定結果表示**
    - ドロップした武器に対する配布予定者の即座表示
    - 該当者が複数いる場合の優先順位表示
    - 手動調整・変更機能
- **優先度**: 高

#### 機能8: レイドティア管理システム
- **概要**: レイドティアの登録・選択機能
- **詳細**: 
  - レイドティアの新規登録（例: 7.2零式、7.4零式）
  - 既存レイドティアの選択・切り替え
  - レイドティア別のデータ管理
  - レイドティア間のデータ移行・参照機能
- **優先度**: 高

### 2.2 認証・認可
- 8人の固定メンバー用の個別アカウント
- リーダー権限（分配確定権限）と一般メンバー権限の区別
- FF14キャラクター名での簡単ログイン

### 2.3 データ管理
- メンバー情報、装備情報、分配履歴の永続化（PostgreSQL）
- 週次リセット対応のデータ管理
- レイドティア別のデータアーカイブ
- Railway PostgreSQL無料枠での運用（500MB制限）
- 8人での同時アクセス・データ共有対応

## 3. 非機能要件

### 3.1 パフォーマンス要件
- 応答時間：2秒以内（一般的な操作）
- 同時アクセス数：8人（最大10人程度を想定）
- データ処理量：週100アイテム程度を想定

### 3.2 セキュリティ要件
- 基本的な認証機能（不正アクセス防止）
- データの改ざん防止
- 分配履歴の改ざん不可能性

### 3.3 可用性・信頼性
- サービス稼働率：95%以上
- 週次活動時間帯（土日夜間）での安定稼働
- 簡単な障害復旧手順の整備

## 4. 技術要件

### 4.1 推奨技術スタック
- **フロントエンド**: React または Vue.js（モダンなUI/UX）
- **バックエンド**: Node.js with Express（Railway対応）
- **データベース**: PostgreSQL（Railway提供）
- **認証**: JWT または簡単なセッション管理
- **ファイルストレージ**: Railway内ボリューム（アイテム画像用、オプション）
- **デプロイメント**: Railway（自動デプロイ対応）

### 4.2 外部サービス連携
- Railway PostgreSQL（データベース）
- Discord Webhook（分配通知用、オプション）
- ゲームのAPI連携（将来的な拡張、オプション）

### 4.3 デプロイメント
- Railway自動デプロイ（GitHub連携）
- 環境変数管理（DATABASE_URL等）
- Railway無料枠内での運用（月500時間制限考慮）

## 5. UI/UX要件

### 5.1 デザイン方針
- 白基調のシンプルモダンなデザイン
- 直感的で分かりやすいインターフェース
- レスポンシブデザイン（PC、タブレット、スマホ対応）
- FF14のジョブアイコン・装備アイコンの活用

### 5.2 ユーザビリティ
- MMO初心者でも理解しやすい操作性
- 装備分配の流れが視覚的に分かりやすい
- モバイルでも基本操作が可能（レイド中のクイック確認）

### 5.3 画面構成・基本ワークフロー

#### 基本的な操作の流れ
1. **レイドティア選択・登録** → 2. **メンバー・装備設定** → 3. **メインダッシュボード** → 4. **各機能画面**

#### 主要画面詳細

1. **レイドティア選択・登録画面**（初期画面）
   - 既存レイドティアの選択（7.2零式、7.4零式等）
   - 新規レイドティアの登録フォーム
   - レイドティア別の進行状況サマリー

2. **初期設定画面**（レイドティア選択後）
   - **メンバー管理**: 8人のポジション・ジョブ設定
   - **装備方針設定**: 各部位の零式/トームストーン選択
   - **武器希望登録**: 4層直ドロップ武器の希望登録
   - 設定完了後、メインダッシュボードへ遷移

3. **メインダッシュボード**（中央ハブ画面）
   - **登録内容確認ボタン** → メンバー・装備設定の確認・変更画面
   - **1層クリアボタン** → 1層装備分配画面
   - **2層クリアボタン** → 2層装備分配画面  
   - **3層クリアボタン** → 3層装備分配画面
   - **4層クリアボタン** → 4層装備分配画面（直ドロップ武器対応）
   - **配布履歴・装備状況ボタン** → 統計・履歴画面
   - 今週の進行状況表示（層別クリア状況・日程）
   - 実装週：層ごとの個別クリア日表示

4. **層別装備分配画面**（レイドクリア時使用）
   - 該当層の固定ドロップ装備表示
   - 各装備のNeed/Greed/Pass判定結果
   - 4層の場合: 直ドロップ武器の配布優先順位表示
   - 分配確定ボタン

5. **登録内容確認・変更画面**
   - メンバー情報の確認・修正
   - 装備方針の確認・変更
   - 武器希望の確認・変更

6. **統計・履歴画面**
   - 配布履歴の可視化
   - 各メンバーの最新装備状況
   - 装備完成度グラフ
   - 週別・層別の分配統計

4. **層別ドロップ管理画面**
   - 各層の固定ドロップ装備表示
   - 週次クリア履歴
   - 装備分配履歴
   - 実装週の複数クリア記録

5. **統計・履歴画面**
   - メンバー別取得装備統計
   - 層別分配履歴
   - レイドティア別アーカイブ

#### 画面遷移フロー（使用頻度順）
```
[レイドティア選択・登録] 
         ↓
[初期設定（メンバー・装備・武器希望）]
         ↓
[メインダッシュボード] ←→ [登録内容確認・変更]
         ↓
[層別装備分配画面（1-4層）] ←→ [統計・履歴画面]
```

## 6. 制約事項

### 6.1 技術的制約
- 8人固定パーティ制（MT/ST/H1/H2/D1/D2/D3/D4）
- FF14零式レイドの仕様に完全準拠
- 火曜17:00 JST リセット時間への対応
- 各層固定ドロップ仕様（変更なし）
- **Railway制約**: 月500時間制限、500MB PostgreSQL無料枠
- **同時アクセス**: 8人での同時利用に対応

### 6.2 運用上の制約
- **実装週**: 層ごとに異なる日にクリア（火曜1層、水曜2層等の可能性）
- **通常週**: 火曜に1-4層まとめてクリア（ただし時間により複数日に跨る場合あり）
- シンプルで直感的な操作性を重視

## 7. 想定される課題とリスク

### 7.1 技術的リスク
- 装備優先順位ロジックの複雑化
- 同時編集時のデータ整合性（レイド中の同時アクセス）
- FF14のパッチ更新による装備システム変更への対応

### 7.2 運用リスク
- メンバー間での装備分配に関する意見相違
- 装備登録の漏れやミス（特に実装週の連続クリア時）
- レイドティア更新時のデータ移行

## 8. 開発・運用計画

### 8.1 開発フェーズ
#### Phase 1 (MVP) - 最優先
- **レイドティア選択・登録機能**
- **初期設定画面**
  - メンバー・ジョブ登録
  - 装備方針設定（零式/トームストーン）
  - 武器希望登録フォーム
- **メインダッシュボード**
  - 各層クリアボタン（1-4層）
  - 登録内容確認ボタン
  - 配布履歴ボタン
- **基本的な装備分配画面**
  - 層別固定ドロップ表示
  - Need/Greed/Pass判定
  - 4層直ドロップ武器配布優先順位
- **登録内容確認・変更画面**

#### Phase 2 - 実用性向上
- **高度な判定システム**
  - 現在装備との比較機能
  - より詳細な優先順位計算
  - **武器取得履歴を考慮した判定**
  - 装備完成度を考慮した判定
- **週次リセット対応**
  - 火曜17:00リセット機能
  - 実装週の層別個別クリア対応（日程のばらつき）
  - 通常週の1-4層まとめてクリア対応
- **基本的な履歴機能**
  - **武器配布履歴の詳細記録**

#### Phase 3 - 拡張機能
- **統計・分析機能**
  - 詳細な分配履歴
  - メンバー別統計
  - 装備格差分析
- **Discord連携**（オプション）
- **エクスポート機能**
- **UI/UX最適化**

### 9.1 FF14零式レイド固有仕様

#### 各層固定ドロップ装備
- **1層**: 耳箱、首箱、腕箱、指箱（各1個）
- **2層**: 頭箱、手箱、足箱、武器石、硬化薬（各1個）
- **3層**: 胴箱、脚箱、強化薬、強化繊維（各1個）
- **4層**: 胴箱、武器箱、マウント、**直ドロップ武器**（各1個）

#### 4層直ドロップ武器システム
- **武器箱**: 取得者が任意のジョブ武器を選択可能
- **直ドロップ武器**: 全ジョブからランダムで1つ、該当ジョブのみ使用可能
- **配布優先順位**:
  1. 登録ジョブに該当 & 武器未取得
  2. 登録ジョブ以外 & 希望登録済み
  3. 該当者なし（分解・保管）

#### 武器希望管理の重要性
- 事前の希望登録により配布トラブルを防止
- ランダムドロップに対する迅速な判定
- サブジョブ育成計画との連携

#### 装備優先順位（確定仕様）
1. **DPS Melee** (主にD1/D2): モンク、竜騎士、忍者、侍、リーパー、ヴァイパー
2. **DPS Range/Caster** (主にD3/D4): 吟遊詩人、機工士、踊り子、黒魔道士、召喚士、赤魔道士、ピクトマンサー
3. **Tank** (MT/ST): ナイト、戦士、暗黒騎士、ガンブレイカー
4. **Healer** (H1/H2): 白魔道士、占星術士、学者、賢者

#### Need/Greed/Pass判定基準
- **Need**: その装備が現在の装備より上位で、かつ装備方針が「零式」の場合
- **Greed**: 装備方針が「トームストーン」だが、将来的に使用可能性がある場合
- **Pass**: 既により良い装備を持っている、または装備方針が「トームストーン」で不要な場合

### 9.2 実装時の重要ポイント
- **瞬時判定**: レイドクリア直後に素早く判定結果を表示
- **4層武器の特別対応**: 直ドロップ武器の配布優先順位を即座に計算・表示
- **視認性**: Need/Greed/Passが一目で分かる色分け表示
- **事前準備**: 武器希望の事前登録により配布時の混乱を防止
- **操作性**: ワンクリックで分配確定できるシンプルなUI
- **確実性**: 分配ミスを防ぐための確認機能

### 9.3 Railway連携の技術的考慮事項
- PostgreSQLスキーマ設計（メンバー、装備、分配履歴テーブル）
- 環境変数管理（DATABASE_URL、JWT_SECRET等）
- Railway自動デプロイ設定（GitHub連携）
- 無料枠制限内での効率的なデータ管理
- 8人での同時アクセス時のデータ整合性確保

### 9.4 直ドロップ武器の技術的考慮事項
- 全ジョブ武器のマスターデータ管理
- ランダムドロップに対するリアルタイム判定
- 希望登録の柔軟な変更・更新機能
- 配布履歴の詳細記録（理由・経緯も含む）

---

**作成日**: [日付]  
**作成者**: [名前]  
**承認者**: [名前]  
**バージョン**: 1.0