# FF14零式装備分配管理システム

## プロジェクト概要
FF14の零式レイドにおいて、8人固定パーティの装備分配を効率的に管理するWebアプリケーション。

## 実装状況

### ✅ 完成済み機能 (Phase 1 MVP)
1. **レイドティア選択・登録機能**
   - 自由命名でレイドティア作成
   - 既存レイドティア選択
   - アクティブレイドティア管理

2. **メンバー・ジョブ管理システム**
   - 8人固定ポジション（MT/ST/H1/H2/D1/D2/D3/D4）
   - ポジション別ジョブ制限
   - プレイヤー名・キャラクター名登録

3. **装備方針管理**
   - 各部位の装備選択（新式・零式 / トームストーン）
   - ポジション別・部位別設定
   - 一括設定機能

4. **4層直ドロップ武器希望登録**
   - 全ジョブ武器への希望登録
   - 優先度設定
   - 希望変更・削除機能

5. **メインダッシュボード**
   - 設定管理
   - レイドクリアボタン（1-4層）
   - 履歴・統計アクセス
   - データエクスポート

6. **データ管理**
   - ローカルストレージベース
   - レイドティア別データ分離
   - JSONエクスポート機能

### 🔄 実装予定機能 (Phase 2以降)
1. **Need/Greed/Pass判定ロジック**
2. **層別装備分配画面**
3. **統計・履歴機能**
4. **週次リセット対応**
5. **武器取得履歴管理**

### 🚀 WebFetch機能実装 (最新アップデート 2025/01/06)
#### ✅ 実装完了
- **FF14データベース検索機能**: 実際のLodestoneデータベースから装備情報を自動取得
- **カテゴリフィルタ検索**: 部位別フィルタで正確な装備検索
  - 武器: `category2=1`
  - 頭防具: `category2=3&category3=34`
  - 胴防具: `category2=3&category3=35` 
  - 手防具: `category2=3&category3=37`
  - 脚防具: `category2=3&category3=36`
  - 足防具: `category2=3&category3=38`
  - アクセサリ: `category2=4&category3=40-43`
- **参照URL表示機能**: 取得したアイテムの参照URLを表示
- **最高アイテムレベル検索**: ページ内で最高ILのチェストを自動検索
- **フォールバックシステム**: WebFetch失敗時の代替データ提供

## ファイル構成
```
FF14_Gear_Allocation_System/
├── working_index.html      # 動作するメイン版
├── test.html              # シンプルテスト版
├── index.html             # 元の分離版（未使用）
├── package.json           # プロジェクト設定
├── README.md              # このファイル
├── src/                   # ソースコード（分離版）
│   ├── models/            # データモデル
│   ├── services/          # サービス層
│   ├── components/        # UIコンポーネント
│   └── utils/            # ユーティリティ
├── data/                  # データファイル（空）
└── public/               # 静的ファイル（空）
```

## 使用方法
1. `working_index.html` をブラウザで開く
2. 新規レイドティアを作成または既存選択
3. メンバー設定 → 装備方針設定 → 武器希望設定
4. メインダッシュボードで各機能を利用

## 技術スタック
- **フロントエンド**: Vanilla JavaScript, HTML5, CSS3
- **データストレージ**: LocalStorage
- **UI**: FF14風ダークテーマ

## 要件定義書対応状況
- ✅ レイドティア管理システム
- ✅ メンバー・ジョブ管理
- ✅ 装備方針管理
- ✅ 4層直ドロップ武器希望登録
- ⏳ 層別装備分配（未実装）
- ⏳ Need/Greed/Pass判定（未実装）
- ⏳ 統計・履歴機能（未実装）

## 最新の開発状況 (2025/01/06 夜)

### 今回のアップデート内容
1. **WebFetch機能の大幅改善**
   - 実際のFF14 Lodestoneデータベースからの装備情報取得を実装
   - カテゴリフィルタによる正確な部位別検索機能を追加
   - 架空のアイテム名生成を排除し、実在データのみ取得するように修正

2. **参照URL表示機能**
   - 取得したアイテムの参照URLをアイテム名の下に表示
   - ユーザーが実際のデータベースページで確認可能

3. **コスト確認**
   - Claude Pro購読により、WebFetch機能は追加費用なしで利用可能であることを確認

### 実装済み検索機能の場所
- **ファイル**: `working_index.html`
- **主要関数**: 
  - `searchFF14Database()` (2296行目〜): メイン検索ロジック
  - `searchHighestILChestForSlot()` (2268行目〜): ラッパー関数
  - `getChestDetailInfo()` (2442行目〜): 詳細情報取得
- **トリガー**: 「Webからアイテム取得」ボタン

### 今後の課題・検証事項
1. **WebFetch機能の動作テスト**
   - 各装備部位での実際の検索結果確認
   - 最高アイテムレベルの正確な取得確認
   - 参照URL表示の動作確認

2. **データ品質の向上**
   - 取得したアイテム名の正確性検証
   - フォールバックデータの充実
   - エラーハンドリングの強化

3. **Phase 2機能の統合**
   - 取得したWebデータと装備分配ロジックの連携
   - Need/Greed/Pass判定への組み込み

### 次回開発開始時の手順
1. `working_index.html`を開いてWebFetch機能をテスト
2. 各装備部位（特に頭防具）で検索結果を確認
3. 実際のFF14データベースから正確なアイテム名が取得できているか検証
4. 問題があれば検索ロジックやプロンプトを調整

## 最新の開発状況 (2025/01/13)

### 今回のアップデート内容（memo.md要望対応）
**✅ 完了済み改善**
1. **初期設定ボタン配置修正**
   - 設定完了ボタンをレイドティア選択ボタンの右側に配置
   - ボタンを緑色で強調表示し、自然な配置に改善

2. **ドロップアイテム表示の簡素化**
   - 「咎人のイヤリング」→「耳」、「咎人のハーバーク」→「胴」等に変更
   - 全ての層別ドロップ、プリセットデータ、ダミーデータを部位名のみに統一
   - より簡潔で分かりやすい表示に改善

**⏳ 次回実装予定（高優先度）**
1. **装備方針・武器希望設定のサイズ調整**
   - 1画面に8人が収まるようにレイアウト最適化
   - CSSグリッドの調整とカードサイズの縮小

2. **ポジション優先設定画面に戻るボタン追加**
   - ナビゲーション改善のためのUIボタン追加

**⏳ 次回実装予定（中優先度）**
3. **装備状況表示の簡素化**
   - 零式かトームストーン以外の部位は「未取得」表示に統一

4. **週別統計の簡素化**
   - プレイヤー別取得数の表示のみに簡素化

### 次回開発開始時の手順
1. `working_index.html`をブラウザで開いて今回の修正を確認
2. 装備方針設定・武器希望設定画面のレイアウト調整を実施
3. 残りのmemo.md要望項目を順次実装
4. 全修正完了後の動作テスト実施

### 技術的メモ
- **修正ファイル**: `working_index.html`（メインの実装ファイル）
- **修正済み関数**: `generateLayerDropsAndProcess()`, `.setup-actions`スタイル
- **データ構造**: LayerDrops配列のname属性を部位名のみに変更済み

## 最新の開発状況 (2025/01/14)

### 今回のアップデート内容（memo.md要望完全対応）
**✅ 完了済み改善**
1. **装備方針プルダウンの視覚改善**
   - 零式・トームストーンの選択項目に落ち着いた色の背景を設定
   - 視覚的な区別を明確化し、ユーザビリティを向上

2. **直ドロップ武器設定ボタンの色調修正**
   - 削除ボタンを灰色系の落ち着いた色に変更
   - 追加ボタンの彩度を下げてテキストの可読性を改善

3. **設定完了ボタンの重複削除**
   - 上部に配置された重複ボタンを削除
   - ボタン配置の整理と統一

4. **各層クリア画面の表示簡素化**
   - 「固定ドロップ」テキストを削除
   - より簡潔な画面構成に改善

5. **ドロップ画面のチェスト名称表示**
   - 部位名の後にチェスト名称を表示（例：頭-ヘッドギアチェスト）
   - 正確なチェスト名対応の実装

6. **IL表示部分の削除**
   - ドロップ画面からアイテムレベル表示を削除
   - 表示の簡素化

7. **配布履歴のコンパクト表示**
   - AWS CloudWatchアラーム風の横一列表示に変更
   - 日付・層・アイテム・取得者を一行で表示

8. **装備状況の視覚改善**
   - 零式・トームストーン設定項目に落ち着いた色の背景を設定
   - ユーザーの設定確認を容易に

9. **週別統計の固定化とソート改善**
   - ポジション並び固定化（MT→ST→H1→H2→D1→D2→D3→D4）
   - 装備スロット順序固定化（武器→頭→胴→手→脚→足→耳→首→腕→指）
   - 取得済み・未取得の明確な分離表示

### memo.md要望対応完了率
**✅ 9/9項目完了（100%）**

### 技術的実装詳細
- **メイン実装ファイル**: `working_index.html`
- **修正された主要関数**:
  - `showWeeklyStatistics()`: 週別統計の固定化
  - `showAllocationHistory()`: コンパクト履歴表示
  - 各種CSS調整: 色彩とレイアウトの最適化
- **データ構造**: チェスト名マッピングの正確な実装

### 開発工程総括
1. **Phase 1: 基本機能実装** (2025/01/06)
   - レイドティア管理、メンバー管理、装備方針管理
   - WebFetch機能による実データ取得

2. **Phase 2: UI/UX改善** (2025/01/13)
   - ボタン配置修正、表示簡素化
   - レイアウト最適化

3. **Phase 3: 詳細改善** (2025/01/14)
   - memo.md全要望対応完了
   - 色彩・配置・表示形式の最適化
   - ユーザビリティの大幅向上

### 次回開発予定
1. **Phase 4: 高度な機能実装**
   - Need/Greed/Pass自動判定ロジック
   - 装備取得履歴の詳細管理
   - 週次リセット対応
   
2. **Phase 5: 拡張機能**
   - データエクスポート・インポート
   - 複数レイドティア比較
   - 統計分析機能